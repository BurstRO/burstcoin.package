#!/bin/sh

USER="burstcoincg"
GROUP="$USER"
CONFFILE="/etc/burstcoincg/nxt.properties"

# source debconf stuff
. /usr/share/debconf/confmodule
. /usr/share/dbconfig-common/dpkg/postinst

#dbc_debug='1'
dbc_mysql_createdb_encoding=utf8mb4
dbc_generate_include="template:/$CONFFILE"
dbc_generate_include_owner="$USER:$GROUP"
dbc_generate_include_args='--ucf -o 
template_infile=/usr/share/burstcoincg/nxt.properties-sample'
dbc_dbtypes=mysql

dbc_go burstcoincg "$@"

set -eu

case "${1}" in
        configure)
                adduser \
                        --system \
                        --home /var/log/burstcoincg \
                        --quiet \
                        --group \
                        ${USER} || true

                for DIR in /var/log/burstcoincg /etc/burstcoincg
                do
                        mkdir -p ${DIR}

                        if ! dpkg-statoverride --list ${DIR} >/dev/null 2>&1
                        then
                                chown -R ${USER}:${GROUP} ${DIR}
                                chmod 750 ${DIR}
                        fi
                done

                if ! dpkg-statoverride --list ${CONFFILE} >/dev/null 2>&1
                then
		    if [ ! -f ${CONFFILE} ]; then
			touch ${CONFFILE}
		    fi
                    dpkg-statoverride --update --add ${USER} ${GROUP} 640 ${CONFFILE}
                fi
		if test -d /usr/lib/x86_64-linux-gnu && ! test -e /usr/lib/x86_64-linux-gnu/libtommath.so.0 ; then
		    ln -sf /usr/lib/x86_64-linux-gnu/libtommath.so.1 /usr/lib/x86_64-linux-gnu/libtommath.so.0
		fi
                ;;

        abort-upgrade|abort-remove|abort-deconfigure)
                ;;

        *)
                echo "postinst called with unknown argument \`${1}'" >&2
                exit 1
                ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

db_stop

exit 0
